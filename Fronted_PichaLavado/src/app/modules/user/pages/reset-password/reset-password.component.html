<div class="reset-container">
    <div class="reset-card">
        <div class="reset-header">
            <h2 class="reset-title">Restablecer Contraseña</h2>
            <p class="reset-description">
                Por favor, ingresa una nueva contraseña para tu cuenta asociada al correo:
                <strong class="email-highlight">{{ email }}</strong>
            </p>
        </div>

        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-form">
            <!-- Indicador de fuerza de contraseña -->
            <div class="password-strength" *ngIf="password.value">
                <div class="strength-meter">
                    <div class="strength-bar" [ngClass]="{
                  'weak': passwordStrength === 'weak',
                  'medium': passwordStrength === 'medium',
                  'strong': passwordStrength === 'strong'
                }" [style.width.%]="getPasswordStrengthPercentage()"></div>
                </div>
                <span class="strength-text" [ngClass]="passwordStrength">
                    {{ passwordStrengthText }}
                </span>
            </div>


            <div class="form-group">
                <label for="password" class="form-label">Nueva Contraseña:</label>
                <div class="password-input-container">
                    <input id="password" [type]="showPassword ? 'text' : 'password'" formControlName="password"
                        class="form-input" placeholder="Mínimo 5 caracteres, 1 mayúscula" autocomplete="new-password" />
                    <button type="button" class="toggle-password" (click)="showPassword = !showPassword"
                        [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
                        <i class="icon" [ngClass]="showPassword ? 'icon-eye-off' : 'icon-eye'"></i>
                    </button>
                </div>

                <div *ngIf="password.invalid && (password.dirty || password.touched)" class="error-messages">
                    <p *ngIf="password.errors?.['required']" class="error-text">
                        <i class="icon-alert"></i> La contraseña es obligatoria.
                    </p>
                    <p *ngIf="password.errors?.['minlength']" class="error-text">
                        <i class="icon-alert"></i> Debe tener al menos 5 caracteres.
                    </p>
                    <p *ngIf="password.errors?.['pattern']" class="error-text">
                        <i class="icon-alert"></i> Debe contener al menos una mayúscula.
                    </p>
                </div>
            </div>

            <div class="password-requirements">
                <h4 class="requirements-title">Requisitos de contraseña:</h4>
                <ul class="requirements-list">
                    <li [ngClass]="{'requirement-met': password.value?.length >= 5 }">
                        <i class="icon" [ngClass]="password.value?.length >= 5 ? 'icon-check' : 'icon-circle'"></i>
                        Mínimo 5 caracteres
                    </li>
                    <li [ngClass]="{'requirement-met': hasUpperCase(password.value)}">
                        <i class="icon" [ngClass]="hasUpperCase(password.value) ? 'icon-check' : 'icon-circle'"></i>
                        Al menos una letra mayúscula
                    </li>
                </ul>
            </div>

            <div class="form-group">
                <label for="confirmPassword" class="form-label">Confirmar Contraseña:</label>
                <div class="password-input-container">
                    <input id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
                        formControlName="confirmPassword" class="form-input" placeholder="Confirma tu nueva contraseña"
                        autocomplete="new-password" />
                    <button type="button" class="toggle-password" (click)="showConfirmPassword = !showConfirmPassword"
                        [attr.aria-label]="showConfirmPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'">
                        <i class="icon" [ngClass]="showConfirmPassword ? 'icon-eye-off' : 'icon-eye'"></i>
                    </button>
                </div>

                <div *ngIf="(confirmPassword.invalid && (confirmPassword.dirty || confirmPassword.touched)) || 
                      (resetPasswordForm.errors?.['mismatch'] && confirmPassword.touched)" class="error-messages">
                    <p *ngIf="confirmPassword.errors?.['required']" class="error-text">
                        <i class="icon-alert"></i> Confirma tu contraseña.
                    </p>
                    <p *ngIf="resetPasswordForm.errors?.['mismatch']" class="error-text">
                        <i class="icon-alert"></i> Las contraseñas no coinciden.
                    </p>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" [disabled]="resetPasswordForm.invalid || isSubmitting" class="submit-button">
                    <span *ngIf="isSubmitting" class="spinner"></span>
                    <span *ngIf="!isSubmitting">Cambiar Contraseña</span>
                </button>
            </div>
        </form>

        <div *ngIf="successMessage" class="success-message">
            <i class="icon-success"></i>
            <p>{{ successMessage }}</p>
            <a routerLink="/login" class="login-link">Iniciar sesión ahora</a>
        </div>

        <div *ngIf="errorMessage" class="error-alert">
            <i class="icon-error"></i>
            <p>{{ errorMessage }}</p>
            <button type="button" class="retry-button" (click)="errorMessage = ''">Intentar nuevamente</button>
        </div>

        <div class="reset-footer" *ngIf="!successMessage">
            <a routerLink="/login" class="back-link">Volver a iniciar sesión</a>
        </div>
    </div>
</div>